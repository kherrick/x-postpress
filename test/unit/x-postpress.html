<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>x-postpress</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="../../node_modules/@webcomponents/webcomponentsjs/webcomponents-bundle.js"></script>
    <script src="../../node_modules/chai/chai.js"></script>
    <script src="../../node_modules/mocha/mocha.js"></script>
    <script src="../../node_modules/wct-mocha/wct-mocha.js"></script>
    <script src="../../node_modules/fetch-mock/dist/es5/client-bundle.js"></script>
  </head>
  <body>
    <test-fixture id="basic">
      <template>
        <x-postpress apiUrl="https://demo.wp-api.org/wp-json/wp/v2/posts"></x-postpress>
      </template>
    </test-fixture>

    <script type="module">
      import '../../src/components/x-postpress.js'
      import '@polymer/test-fixture'
      import 'axe-core/axe.min.js'
      import { axeReport } from 'pwa-helpers/axe-report.js'
      import posts from '../fixtures/posts/esm.js'

      describe('x-postpress tests', () => {
        let xPostpress

        beforeEach(() => {
          fetchMock.get('https://demo.wp-api.org/wp-json/wp/v2/posts', posts);

          xPostpress = fixture('basic')

          // Make tests wait until element is rendered.
          return xPostpress.updateComplete
        })

        afterEach(() => {
          fetchMock.restore()
        })

        it('has articles property length defaulted to 0', () => {
          assert.equal(xPostpress.articles.length, 0)
        })

        it('populates articles property with equal number of articles as the fixture', () => new Promise((res, rej) => {
          // Make this test wait until the articles property has a length equal to the fixture length
          setInterval(function () {

            if (xPostpress.articles.length === posts.length) {
              res(xPostpress)
            }
          }, 0)
        }))
      })
    </script>
  </body>
</html>
