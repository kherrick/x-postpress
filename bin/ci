#!/usr/bin/env bash

readonly SCRIPT_SOURCE="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"

cd "${SCRIPT_SOURCE}/.." || exit 1

if [[ "$CI" != "true" ]]; then
  printf 'this script is intended to be ran in a continuous integration environment\n' && exit 1
fi

docker run -it --rm -v "$(pwd)":/x-postpress kherrick/x-postpress-test:latest bash -c 'sudo npm i --unsafe-perm' \
 && docker run -it --rm -v "$(pwd)":/x-postpress kherrick/x-postpress-test:latest bash -c 'sudo npm run test:unit' \
 && docker run -it --rm -v "$(pwd)":/x-postpress kherrick/x-postpress-test:latest bash -c 'sudo npm run test:integration'
